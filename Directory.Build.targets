<?xml version="1.0" encoding="utf-8"?>
<Project>
  <Import Project="$(RepositoryEngineeringDir)CodeStyle.targets" />
  <Import Project="Sdk.targets" Sdk="Microsoft.DotNet.Arcade.Sdk" />
  <Import Project="$(RepositoryEngineeringDir)versioning.targets" />
  <!-- to prevent using MS.NC.Platforms from SDK, which is lagging behind the version that WinForms gets from the CoreFx packages -->
  <ItemGroup>
    <PackageReference Update="Microsoft.NETCore.Platforms" Version="$(MicrosoftNETCorePlatformsPackageVersion)" />
  </ItemGroup>

  <!-- For the purposes of generating code coverage as part of the build -->
  <!-- Workaround for https://github.com/tonerdo/coverlet/pull/318 is released -->
  <Target Name="UpdateTargetPathForCoverage" BeforeTargets="InstrumentModulesNoBuild;InstrumentModulesAfterBuild">
    <PropertyGroup>
      <_CoverletOriginalTargetPath>$(TargetPath)</_CoverletOriginalTargetPath>
      <TargetPath>$([System.IO.Path]::GetDirectoryName($(TargetPath)))\NonExistent.dll</TargetPath>
    </PropertyGroup>
  </Target>
  <Target Name="UpdateTargetPathAfterCoverage" AfterTargets="InstrumentModulesNoBuild;InstrumentModulesAfterBuild">
    <PropertyGroup>
      <TargetPath>$(_CoverletOriginalTargetPath)</TargetPath>
    </PropertyGroup>
  </Target>
</Project>

